import streamlit as st
import pandas as pd

st.set_page_config(page_title="–ú–∞–∫—Å–∏–º–∞–ª–µ–Ω –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä", layout="centered")

st.title("üöÄ –ú–∞–∫—Å–∏–º–∞–ª–Ω–∞ –°—Ä–µ–¥–Ω–∞ –¶–µ–Ω–∞")
st.write("–ù–∞–º–∏—Ä–∞–Ω–µ –Ω–∞ 12-—Ç–µ –Ω–∞–π-—Å–∫—ä–ø–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ (–æ–±—â–æ 3 —á–∞—Å–∞) –∑–∞ —Ü–µ–ª–∏—è –¥–µ–Ω.")

# –û–ø—Ä–∞–≤—è–º–µ –ø—Ä–æ–±–ª–µ–º–∞ —Å –∏–∑–±–æ—Ä–∞ –Ω–∞ —Ñ–∞–π–ª –Ω–∞ Android
uploaded_file = st.file_uploader("–ò–∑–±–µ—Ä–∏ —Ñ–∞–π–ª", type=['csv', 'txt'])

if uploaded_file is not None:
    try:
        df = pd.read_csv(uploaded_file, sep=';', skiprows=9)
        df.columns = [c.strip() for c in df.columns]
        
        if df['–¶–µ–Ω–∞ (EUR/MWh)'].dtype == object:
            df['–¶–µ–Ω–∞ (EUR/MWh)'] = df['–¶–µ–Ω–∞ (EUR/MWh)'].str.replace(',', '.').astype(float)

        # 1. –°–æ—Ä—Ç–∏—Ä–∞–º–µ –í–°–ò–ß–ö–ò –∏–Ω—Ç–µ—Ä–≤–∞–ª–∏ –ø–æ —Ü–µ–Ω–∞ (–Ω–∞–π-—Å–∫—ä–ø–∏—Ç–µ –æ—Ç–≥–æ—Ä–µ)
        df_sorted = df.sort_values(by='–¶–µ–Ω–∞ (EUR/MWh)', ascending=False)

        # 2. –í–∑–µ–º–∞–º–µ –Ω–∞–π-–¥–æ–±—Ä–∏—Ç–µ 12 –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ (12 * 15 –º–∏–Ω = 3 —á–∞—Å–∞)
        top_12 = df_sorted.head(12).copy()
        
        # –ü–æ–¥—Ä–µ–∂–¥–∞–º–µ –≥–∏ –ø–æ —á–∞—Å, –∑–∞ –¥–∞ —Ç–∏ –µ –ª–µ—Å–Ω–æ –¥–∞ –≥–∏ —á–µ—Ç–µ—à
        top_12 = top_12.sort_index()

        st.subheader("üèÜ –¢–≤–æ–∏—Ç–µ 12 –∑–ª–∞—Ç–Ω–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞:")
        
        for index, row in top_12.iterrows():
            st.info(f"üïí **{row['–ü–µ—Ä–∏–æ–¥ –Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞']}** | –¶–µ–Ω–∞: **{row['–¶–µ–Ω–∞ (EUR/MWh)']} EUR**")

        # 3. –ò–∑—á–∏—Å–ª—è–≤–∞–º–µ –∞–±—Å–æ–ª—é—Ç–Ω–∞—Ç–∞ –º–∞–∫—Å–∏–º–∞–ª–Ω–∞ —Å—Ä–µ–¥–Ω–∞ —Ü–µ–Ω–∞
        max_avg = top_12['–¶–µ–Ω–∞ (EUR/MWh)'].mean()
        
        st.success(f"üìà –ú–ê–ö–°–ò–ú–ê–õ–ù–ê –°–†–ï–î–ù–ê –¶–ï–ù–ê (3—á –æ–±—â–æ): **{max_avg:.2f} EUR/MWh**")
        
        # –í–∏–∑—É–∞–ª–Ω–∞ –≥—Ä–∞—Ñ–∏–∫–∞
        st.bar_chart(df.set_index('–ü–µ—Ä–∏–æ–¥ –Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞')['–¶–µ–Ω–∞ (EUR/MWh)'])

    except Exception as e:
        st.error(f"–ì—Ä–µ—à–∫–∞: –ü—Ä–æ–≤–µ—Ä–∏ –¥–∞–ª–∏ —Ñ–∞–π–ª—ä—Ç –µ –ø—Ä–∞–≤–∏–ª–µ–Ω. {e}")
        
